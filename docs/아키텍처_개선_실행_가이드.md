# Flutter 테스트 중심 아키텍처 개선 실행 가이드

- 대상 프로젝트: `wpi_app` (`c:\Users\enjum\interpreter_front_flutter`)
- 기준일: 2026-02-16
- 목적: 테스트 가능한 구조로 점진적 개선(MVVM + Repository/Service + 선택적 Use-case + 생성자 DI)

## 작업 완료 확인 (2026-02-16)

- 상태: 완료(요청 범위 기준)
- 완료 항목:
1. `Phase 0` 기반 계층 추가 완료
2. `Phase 1(Auth 세로 슬라이스)` 대상 화면 4개 전환 완료
3. 경계 검증 스크립트/단위 테스트 추가 및 실행 완료

### 완료 세부 내역

1. 기반 계층 추가
- `lib/common/result.dart`
- `lib/common/failure.dart`
- `lib/domain/model/*` (Auth/Terms/SignUp 요청 모델)
- `lib/domain/repository/auth_repository.dart`
- `lib/data/repository/auth_repository_impl.dart`
- `lib/app/di/app_scope.dart`
- `lib/ui/auth/view_models/*`

2. Auth 화면 경계 분리 완료
- `lib/screens/auth/login_screen.dart`
- `lib/screens/auth/email_login_screen.dart`
- `lib/screens/auth/signup_screen.dart`
- `lib/screens/settings/terms_agreement_settings_screen.dart`
- 위 4개 화면에서 `services/` 직접 import 제거

3. 검증 자동화/테스트 완료
- 경계 스크립트: `tool/check_ui_service_boundary.dart`
- Fake 저장소: `test/testing/fakes/fake_auth_repository.dart`
- 단위 테스트:
  - `test/unit/ui/auth/login_view_model_test.dart`
  - `test/unit/ui/auth/signup_view_model_test.dart`
- 실행 결과:
  - `dart run tool/check_ui_service_boundary.dart` 통과
  - `dart run tool/check_ui_service_boundary.dart --all` 미통과(나머지 화면은 다음 Phase 대상)
  - `flutter test test/unit/ui/auth/login_view_model_test.dart test/unit/ui/auth/signup_view_model_test.dart` 통과
  - `flutter analyze ...`(변경 범위) 통과

### 추가 완료 내역 (2026-02-16, Phase 2 일부)

1. Dashboard 화면 경계 분리 완료
- `lib/screens/dashboard_screen.dart`
- `lib/ui/dashboard/dashboard_view_model.dart`
- `lib/domain/repository/dashboard_repository.dart`
- `lib/data/repository/dashboard_repository_impl.dart`
- `lib/domain/model/dashboard_models.dart`
- `lib/app/di/app_scope.dart`에 dashboard 의존성 등록
- `dashboard_screen`에서 `services/` 직접 import 제거

2. Dashboard 테스트/검증 추가
- Fake 저장소: `test/testing/fakes/fake_dashboard_repository.dart`
- 단위 테스트: `test/unit/ui/dashboard/dashboard_view_model_test.dart`
- 검증 결과:
  - `dart run tool/check_ui_service_boundary.dart` 통과
  - `flutter test test/unit/ui/dashboard/dashboard_view_model_test.dart` 통과
  - `flutter test` 전체 통과
  - `dart run tool/check_ui_service_boundary.dart --all` 미통과(잔여 화면 이전 필요)

---

## 1. 무엇을 위해 이 작업을 하는가

핵심 목표는 다음 4가지입니다.

1. 화면(UI)에서 비즈니스 로직과 IO를 분리해 변경 비용을 낮춘다.
2. 의존성을 인터페이스로 뒤집어(mock/fake 교체) 테스트 속도와 안정성을 높인다.
3. 기능 추가 시 기존 코드 영향 범위를 축소해 회귀 버그를 줄인다.
4. 인력/기능이 늘어도 유지보수 가능한 구조를 확보한다.

이 프로젝트 기준으로 보면, `lib/screens`에서 `lib/services`를 직접 import/호출하는 화면이 다수 존재합니다.
예:

- `lib/screens/dashboard_screen.dart`
- `lib/screens/auth/login_screen.dart`
- `lib/screens/result/user_result_detail_screen.dart`
- `lib/screens/mymind/interpretation_panel.dart`
- `lib/screens/test/wpi_selection_flow_new.dart`

현재 스냅샷(2026-02-16):

- `screens`: 45개
- `services`: 7개
- `models`: 5개

화면이 IO를 직접 호출하면 다음 문제가 반복됩니다.

1. widget test에서 네트워크/스토리지 의존이 섞여 실패 원인 추적이 어려움
2. 비즈니스 규칙 변경 시 여러 화면에 중복 수정 발생
3. 전역 싱글톤/암묵적 의존성 때문에 테스트 순서 의존(flaky) 발생

---

## 2. 왜 이 구조가 필요한가

권장 구조(MVVM + Repository/Service + 선택적 Use-case)는 Flutter 공식 아키텍처 가이드와 맞습니다. [1][2][3]

테스트 관점 이점:

1. `ViewModel`/`Use-case`를 순수 Dart로 유지하면 unit test가 빠르고 안정적입니다.
2. `Repository` 인터페이스를 두면 fake/mock 대체가 쉬워집니다.
3. `Widget`은 ViewModel만 주입받아 테스트하면 되므로 시나리오 작성이 단순해집니다.
4. IO가 `Service`로 내려가면 실패 지점을 좁게 격리할 수 있습니다.

---

## 3. 목표 아키텍처(How의 기준선)

```text
UI(View)
  -> ViewModel(UI state/event)
    -> (Optional) Use-case(복합/재사용 비즈니스 로직)
      -> Repository(interface)
        -> Service(REST/DB/File/Platform IO)
```

의존 규칙(단방향):

1. View는 ViewModel만 의존
2. ViewModel은 Use-case 또는 Repository만 의존
3. Repository 구현체만 Service를 의존
4. Service는 상태를 최소화하고 IO에 집중

절대 규칙:

1. ViewModel/Use-case에서 `BuildContext` 사용 금지
2. ViewModel/Use-case에서 Flutter UI import 금지(가능하면 순수 Dart)
3. 외부 의존성은 모두 생성자 주입
4. DTO/Entity(data)와 앱 모델(domain)은 필요 시 분리

---

## 4. 프로젝트 맞춤 권장 패키지 구조

현재 구조(`screens/services/models`)를 완전 재작성하지 않고, 점진적으로 아래처럼 확장합니다.

```text
lib/
  app/
    di/
      app_scope.dart
    router/
      app_router.dart
  ui/
    auth/
      login_screen.dart
      login_view_model.dart
      signup_screen.dart
      signup_view_model.dart
    dashboard/
      dashboard_screen.dart
      dashboard_view_model.dart
    result/
      user_result_detail_screen.dart
      user_result_detail_view_model.dart
    ...
  domain/
    model/
      user.dart
      auth_session.dart
      test_result.dart
    repository/
      auth_repository.dart
      psych_test_repository.dart
      payment_repository.dart
      interpretation_repository.dart
    usecase/
      login_with_social_use_case.dart
      load_user_result_bundle_use_case.dart
  data/
    repository/
      auth_repository_impl.dart
      psych_test_repository_impl.dart
      payment_repository_impl.dart
      interpretation_repository_impl.dart
    service/
      auth_api_service.dart
      psych_test_api_service.dart
      payment_api_service.dart
      ai_api_service.dart
      notification_service.dart
    dto/
      auth_dto.dart
      user_result_dto.dart
    mapper/
      auth_mapper.dart
      result_mapper.dart
  common/
    result.dart
    failure.dart
    logger.dart
  testing/
    fakes/
    mocks/
```

`test/`는 구조를 미러링합니다.

```text
test/
  unit/
    domain/
    ui/
  widget/
    ui/
  integration/
```

---

## 5. 현재 코드 기준 문제-개선 매핑

### A. 화면이 서비스를 직접 호출

현재:

- `lib/screens/dashboard_screen.dart`는 `DashboardViewModel`로 전환 완료(직접 서비스 import 제거)
- `lib/screens/auth/login_screen.dart`에서 `AuthService` 직접 사용
- `lib/screens/result/user_result_detail_screen.dart`에서 `AuthService/UserResultDetailService` 직접 사용

개선:

- 화면은 `*ViewModel`만 참조
- 서비스 호출은 Repository/Use-case 아래로 이동

### B. 서비스의 역할 혼재(상태 + IO + 도메인 로직)

현재:

- `lib/services/auth_service.dart`가 `ChangeNotifier`, 토큰 저장, API 호출, 소셜 SDK 연동, 에러 해석까지 모두 담당

개선:

1. `AuthApiService`: 네트워크/SDK 연동
2. `AuthRepositoryImpl`: 토큰/세션/매핑/정책
3. `LoginViewModel`: 화면 상태(`loading/error/success`)

### C. 전역 싱글톤 사용

현재:

- `factory AuthService() => _instance`
- `factory PaymentService() => _instance`
- `factory NotificationService() => _instance`

개선:

1. 앱 루트에서 명시적으로 생성
2. 생성자 주입으로 전달
3. 테스트에서 fake 구현 교체

---

## 6. 단계별 실행 계획(무엇을 해야 하는가)

### Phase 0. 기준선 확보(1~2일)

해야 할 일:

1. 아키텍처 디렉터리 뼈대 생성(`lib/ui`, `lib/domain`, `lib/data`, `lib/common`, `lib/testing`)
2. 공통 결과 타입 도입(`Result<T>`, `Failure`)
3. 기존 핵심 플로우 테스트 최소 기준 정의

산출물:

- 신규 폴더 구조
- 실패/성공 표준 타입
- "현재 동작 보장" 테스트 목록

완료 기준:

- 기존 주요 화면 진입/로그인/결과조회 수동 시나리오 정상
- CI에서 최소 smoke test 통과

### Phase 1. Auth 세로 슬라이스 마이그레이션(3~5일)

대상:

- `login_screen`, `email_login_screen`, `signup_screen`, `terms_agreement_settings_screen`

해야 할 일:

1. `domain/repository/auth_repository.dart` 인터페이스 정의
2. `data/repository/auth_repository_impl.dart` 생성
3. `data/service/auth_api_service.dart`로 IO 분리
4. `ui/auth/*_view_model.dart` 생성
5. 기존 화면에서 `AuthService` 직접 참조 제거

테스트:

1. `LoginViewModel` unit test
2. `SignupViewModel` unit test
3. 로그인 성공/실패 widget test(fake repository 사용)

완료 기준:

- Auth 관련 화면에서 서비스 직접 import 0건
- Auth 관련 ViewModel 테스트 통과

### Phase 2. Dashboard + Result 흐름 이전(5~7일)

대상:

- `dashboard_screen`
- `user_result_single_screen`
- `user_result_detail_screen`

해야 할 일:

1. `PsychTestRepository`, `InterpretationRepository` 인터페이스 정의
2. 복합 로직은 Use-case로 분리
3. 화면 상태 전이를 ViewModel로 이전

테스트:

1. `DashboardViewModel` 상태 전이 테스트
2. `UserResultDetailViewModel` 초기해석 생성 성공/실패 테스트

완료 기준:

- 대상 화면에서 서비스 직접 생성/호출 제거
- 핵심 시나리오(로딩/성공/에러/재시도) 단위 테스트 확보

### Phase 3. 결제/마이페이지/설정 이전(3~5일)

대상:

- `payment_webview_screen`
- `profile/*`
- `settings/*`

해야 할 일:

1. `PaymentRepository`, `NotificationRepository` 분리
2. 플랫폼/권한 호출은 Service로 고정
3. UI는 ViewModel만 참조

완료 기준:

- 결제/설정 플로우에서 IO 직접 호출 제거
- 주요 예외 처리 정책(권한 거부/결제 실패) 테스트화

### Phase 4. 정리 및 품질 게이트(2~3일)

해야 할 일:

1. 남은 `lib/screens -> lib/services` 직접 의존 제거
2. 중복 모델 정리(DTO vs domain model)
3. 문서/컨벤션/PR 템플릿 업데이트

완료 기준:

- 직접 의존 탐지 스크립트 통과
- 신규 기능 PR에서 아키텍처 규칙 자동 검증 가능

---

## 7. 실무 규칙(팀 합의용)

필수 규칙:

1. ViewModel/Use-case는 `BuildContext` 금지
2. ViewModel은 Flutter 위젯 import 금지
3. 네트워크/스토리지/플랫폼 접근은 Service로 제한
4. 화면 파일에서 `services/` import 금지
5. 의존성은 생성자 주입만 허용

권장 규칙:

1. 비즈니스 로직이 2개 이상 화면에서 재사용되면 Use-case로 승격
2. ViewModel은 상태(State)와 사용자 이벤트 처리만 담당
3. 예외는 `Failure`로 표준화해 UI 메시지 일관성 유지

---

## 8. Use-case 도입 기준(오버엔지니어링 방지)

아래 중 하나라도 해당하면 Use-case를 추가합니다.

1. 여러 Repository 결과를 합쳐야 함
2. ViewModel이 비대해짐(단일 파일에서 책임이 과다)
3. 동일 로직이 다수 화면에서 재사용됨
4. 트랜잭션/정책/검증 규칙이 도메인 핵심임

해당하지 않으면:

- ViewModel -> Repository 직결 유지(단순 흐름 최적화)

---

## 9. 테스트 전략

목표 피라미드:

1. Unit test 70%
2. Widget test 20%
3. Integration test 10%

테스트 단위:

1. ViewModel: 상태 전이, 입력 검증, 에러 맵핑
2. Use-case: 도메인 규칙, 멀티 리포지토리 조합
3. Repository: Service 응답 매핑/예외 변환
4. Widget: 상태별 렌더링/사용자 이벤트 위임

Fake/Mock 전략:

1. 기본은 Fake 구현(`lib/testing/fakes`)
2. 호출 횟수/인자 검증이 필요할 때만 Mock 사용
3. 외부 IO는 unit test에서 직접 호출 금지

---

## 10. 예시 구현 패턴

### Repository 인터페이스

```dart
abstract interface class AuthRepository {
  Future<Result<AuthSession>> loginWithEmail({
    required String email,
    required String password,
  });
}
```

### ViewModel

```dart
class LoginViewModel {
  LoginViewModel(this._authRepository);
  final AuthRepository _authRepository;

  final ValueNotifier<bool> isLoading = ValueNotifier(false);
  final ValueNotifier<String?> error = ValueNotifier(null);

  Future<bool> login(String email, String password) async {
    isLoading.value = true;
    error.value = null;
    final result = await _authRepository.loginWithEmail(
      email: email,
      password: password,
    );
    isLoading.value = false;
    return result.when(
      success: (_) => true,
      failure: (f) {
        error.value = f.userMessage;
        return false;
      },
    );
  }
}
```

### Composition Root(생성자 주입)

```dart
final authApiService = AuthApiService(dio);
final authRepository = AuthRepositoryImpl(
  api: authApiService,
  secureStorage: secureStorage,
);
final loginViewModel = LoginViewModel(authRepository);
```

---

## 11. 완료 정의(Definition of Done)

기능 단위로 아래를 모두 만족하면 완료로 봅니다.

1. 화면 파일에서 `services/` import 없음
2. ViewModel/Use-case 단위 테스트 존재
3. 화면 widget test 최소 1개 이상
4. 의존성은 생성자 주입으로 교체 가능
5. 실패 케이스(네트워크/권한/인증 만료) 명시적 처리
6. PR 설명에 "경계 준수 여부" 체크 포함

---

## 12. 이번 프로젝트의 우선순위 백로그

P0(즉시):

1. 아키텍처 뼈대 폴더 추가
2. `Result/Failure` 공통 타입 도입
3. 화면의 `services/` 직접 import 탐지 스크립트 추가

P1(가장 효과 큼):

1. Auth 플로우를 ViewModel + Repository로 분리
2. Dashboard 데이터를 ViewModel로 이관

P2(복잡도 감소):

1. Result Detail/Interpretation 흐름 Use-case 분리
2. Payment/Settings의 플랫폼 호출 경계 정리

P3(운영 안정화):

1. 테스트 템플릿 표준화
2. 신규 기능 개발 시 아키텍처 규칙 CI 체크

---

## 13. 참고 자료

- [1] Flutter Architecture recommendations: https://docs.flutter.dev/app-architecture/recommendations
- [2] Flutter Architecture guide: https://docs.flutter.dev/app-architecture/guide
- [3] Flutter Architecture case study(Compass): https://docs.flutter.dev/app-architecture/case-study


---

## 14. Additional Completion Log (2026-02-16, Phase 2 Result)

- Status: Work completion confirmed (`작업 완료 확인`)
- Completed scope:
1. Added `ResultRepository` boundary and Result domain models
2. Added `ResultRepositoryImpl` and wired `AppScope` dependency registration
3. Migrated `user_result_single_screen` and `user_result_detail_screen` to ViewModel-based state handling
4. Removed direct `services/` imports from Result detail/single UI and profile sections
5. Added unit tests and fake repository for Result ViewModels
6. Expanded default boundary-check target list to include Result screens
- Validation results:
1. `flutter analyze` (changed files): pass
2. `dart run tool/check_ui_service_boundary.dart`: pass
3. `flutter test`: pass
4. `dart run tool/check_ui_service_boundary.dart --all`: still failing on remaining non-migrated screens (expected for next phase)


---

## 15. Additional Completion Log (2026-02-16, Phase 3 Partial)

- Status: Work completion confirmed (`작업 완료 확인`)
- Completed scope:
1. Added `PaymentRepository` and `NotificationRepository` boundaries with domain models
2. Added repository implementations and DI wiring in `AppScope`
3. Migrated `payment_history_screen` to `PaymentHistoryViewModel`
4. Migrated `notification_settings_screen` to `NotificationSettingsViewModel`
5. Replaced direct payment service usage in `payment_webview_screen` with repository usage
6. Added unit tests for payment history and notification settings ViewModels
7. Expanded default boundary-check targets for migrated payment/settings screens
- Validation results:
1. `flutter analyze` (changed files): pass
2. `dart run tool/check_ui_service_boundary.dart`: pass
3. `flutter test`: pass
4. `dart run tool/check_ui_service_boundary.dart --all`: still failing on remaining non-migrated screens (`main_shell`, `mymind/*`, `test/*`, `profile/my_page_screen.dart`)


---

## 16. Additional Completion Log (2026-02-16, Phase 3 Profile/Main Slice)

- Status: Work completion confirmed (`작업 완료 확인`)
- Completed scope:
1. Added `ProfileRepository` boundary and profile domain models
2. Added `ProfileRepositoryImpl` and DI wiring in `AppScope`
3. Added `MainShellViewModel` and migrated `main_shell.dart` to repository-driven auth state handling
4. Added `MyPageViewModel` and migrated `my_page_screen.dart` to ViewModel + repository flow
5. Removed direct `services/` imports from:
   - `lib/screens/main_shell.dart`
   - `lib/screens/profile/my_page_screen.dart`
6. Added fake/profile unit tests:
   - `test/testing/fakes/fake_profile_repository.dart`
   - `test/unit/ui/main/main_shell_view_model_test.dart`
   - `test/unit/ui/profile/my_page_view_model_test.dart`
7. Expanded default boundary-check targets to include `main_shell.dart` and `my_page_screen.dart`
- Validation results:
1. `flutter analyze` (changed files): pass
2. `flutter test test/unit/ui/main/main_shell_view_model_test.dart test/unit/ui/profile/my_page_view_model_test.dart`: pass
3. `flutter test`: pass
4. `dart run tool/check_ui_service_boundary.dart`: pass
5. `dart run tool/check_ui_service_boundary.dart --all`: still failing on remaining non-migrated screens (`mymind/*`, `test/*`)


---

## 17. Additional Completion Log (2026-02-16, Phase 3 MyMind Slice A)

- Status: Work completion confirmed (`작업 완료 확인`)
- Completed scope:
1. Extended `ResultRepository` boundary with account pagination API
2. Added Result account domain models:
   - `ResultAccount`
   - `ResultAccountPage`
3. Updated `ResultRepositoryImpl` account mapping and fake repository support
4. Migrated `my_mind_page.dart` result list panel to repository-based data/auth access
5. Migrated `today_mind_read_flow_screen.dart` to repository-based auth/account/detail/initial-interpretation flow
6. Removed direct `services/` imports from:
   - `lib/screens/mymind/my_mind_page.dart`
   - `lib/screens/mymind/today_mind_read_flow_screen.dart`
- Validation results:
1. `flutter analyze` (changed files): pass
2. `flutter test`: pass
3. `dart run tool/check_ui_service_boundary.dart`: pass
4. `dart run tool/check_ui_service_boundary.dart --all`: still failing on remaining non-migrated screens:
   - `lib/screens/mymind/interpretation_panel.dart`
   - `lib/screens/mymind/interpretation_record_panel.dart`
   - `lib/screens/test/wpi_review_screen.dart`
   - `lib/screens/test/wpi_selection_flow_new.dart`
   - `lib/screens/test/wpi_selection_screen.dart`


---

## 18. Additional Completion Log (2026-02-16, Phase 3 MyMind Slice B)

- Status: Work completion confirmed (`작업 완료 확인`)
- Completed scope:
1. Extended `ResultRepository` with conversation APIs:
   - `interpret`
   - `fetchConversation`
   - `fetchConversationSummaries`
2. Added domain JSON parsing support for:
   - `UserResultDetail`
   - `UserResultRow`
   - `ResultClassItem`
   - `ResultAccount`
3. Migrated `interpretation_panel.dart` to repository-based auth/result/conversation access
4. Migrated `interpretation_record_panel.dart` to repository-based auth/conversation access
5. Removed direct `services/` imports from:
   - `lib/screens/mymind/interpretation_panel.dart`
   - `lib/screens/mymind/interpretation_record_panel.dart`
6. Expanded default boundary-check target list to include the two migrated mymind screens
- Validation results:
1. `flutter analyze --no-fatal-infos` (changed files): pass
2. `flutter test`: pass
3. `dart run tool/check_ui_service_boundary.dart`: pass
4. `dart run tool/check_ui_service_boundary.dart --all`: still failing on remaining non-migrated screens:
   - `lib/screens/test/wpi_review_screen.dart`
   - `lib/screens/test/wpi_selection_flow_new.dart`
   - `lib/screens/test/wpi_selection_screen.dart`


---

## 19. Additional Completion Log (2026-02-16, Phase 4 Test Flow Slice)

- Status: Work completion confirmed (`작업 완료 확인`)
- Completed scope:
1. Added `PsychTestRepository` boundary and psych-test domain models:
   - `PsychTestItem`
   - `PsychTestChecklist`
   - `WpiSelections`
   - `EvaluationRole`
2. Added `PsychTestRepositoryImpl` and wired DI in `AppScope`
3. Migrated test flow screens to repository-based access and removed direct `services/` imports:
   - `lib/screens/test/wpi_review_screen.dart`
   - `lib/screens/test/wpi_selection_flow_new.dart`
   - `lib/screens/test/wpi_selection_screen.dart`
4. Updated route argument types to use domain psych-test models:
   - `lib/router/app_routes.dart`
5. Expanded default boundary-check target list to include migrated test screens:
   - `tool/check_ui_service_boundary.dart`
- Validation results:
1. `dart run tool/check_ui_service_boundary.dart`: pass
2. `dart run tool/check_ui_service_boundary.dart --all`: pass
3. `flutter test`: pass
4. `flutter analyze --no-fatal-infos` (changed files): pass (info-level lints remain in legacy UI code)


---

## 20. Additional Completion Log (2026-02-16, Phase 4 Test Flow Slice B)

- Status: Work completion confirmed (`작업 완료 확인`)
- Completed scope:
1. Added WPI test-flow fake repository for unit-test injection:
   - `test/testing/fakes/fake_psych_test_repository.dart`
2. Added `WpiReviewViewModel` to separate submit/update IO from UI:
   - `lib/ui/test/wpi_review_view_model.dart`
3. Migrated `wpi_review_screen` to use the ViewModel instead of direct repository calls:
   - `lib/screens/test/wpi_review_screen.dart`
4. Added ViewModel unit tests:
   - `test/unit/ui/test/wpi_review_view_model_test.dart`
- Validation results:
1. `flutter test test/unit/ui/test/wpi_review_view_model_test.dart`: pass
2. `flutter test`: pass
3. `dart run tool/check_ui_service_boundary.dart`: pass
4. `dart run tool/check_ui_service_boundary.dart --all`: pass
5. `flutter analyze --no-fatal-infos` (changed files): pass (legacy info-level lint remains in UI style code)


---

## 21. Additional Completion Log (2026-02-16, Phase 4 Test Flow Slice C)

- Status: Work completion confirmed (`작업 완료 확인`)
- Completed scope:
1. Added `WpiSelectionFlowViewModel` to separate checklist loading/sorting and submit/update decisions from screen UI:
   - `lib/ui/test/wpi_selection_flow_view_model.dart`
2. Migrated `wpi_selection_flow_new` to use ViewModel for:
   - checklist load (`loadChecklists`)
   - initial stage resolution (`resolveInitialIndex`)
   - submit/update branch (`submitSelection`)
   - result id extraction (`extractResultId`)
3. Added unit tests for the new ViewModel:
   - `test/unit/ui/test/wpi_selection_flow_view_model_test.dart`
- Validation results:
1. `flutter test test/unit/ui/test/wpi_selection_flow_view_model_test.dart`: pass
2. `flutter test`: pass
3. `dart run tool/check_ui_service_boundary.dart --all`: pass
4. `flutter analyze --no-fatal-infos` (changed files): pass (legacy info-level lint remains in UI style code)


---

## 22. Additional Completion Log (2026-02-16, Phase 4 Test Flow Slice D)

- Status: Work completion confirmed (`작업 완료 확인`)
- Completed scope:
1. Added `WpiSelectionViewModel` for classic round flow:
   - checklist loading
   - rank selection mapping to `WpiSelections`
   - process-sequence resolution
   - result-id extraction
2. Migrated `wpi_selection_screen` to use ViewModel for load/mapping/parsing logic:
   - `lib/screens/test/wpi_selection_screen.dart`
3. Added unit tests:
   - `test/unit/ui/test/wpi_selection_view_model_test.dart`
- Validation results:
1. `flutter test test/unit/ui/test/wpi_selection_view_model_test.dart`: pass
2. `flutter test`: pass
3. `dart run tool/check_ui_service_boundary.dart --all`: pass
4. `flutter analyze --no-fatal-infos` (changed files): pass (legacy info-level lint remains in UI style code)
